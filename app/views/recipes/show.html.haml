%h3= @recipe.title
%p= @recipe.description
%p= @recipe.ingredients
%p= @recipe.directions
%p
  Posted by:
  = mail_to @recipe.user.email

#rating
  - 5.times do |i|
    = button_tag "#{i + 1}", data: {rating: "#{i + 1}"}

- @recipe.comments.each do |comment|
  .box
    %p= comment.body
    %p
      Written by
      = mail_to comment.user.email

= form_with(model: [ @recipe, @recipe.comments.build ], local: true) do |form|
  - if user_signed_in?
    = form.label :body
    = form.text_area :body
    = form.submit
-if user_signed_in? && policy(@recipe).edit?
  = link_to "Edit Recipe", edit_recipe_path
= link_to "Back", root_path
:javascript
  let ratingButtons = document.querySelectorAll('button')
  ratingButtons.forEach((button)=>{
    button.addEventListener('click',()=>{
      let value = button.dataset.rating
      let body = JSON.stringify({rating: value })
      fetch("#{recipe_ratings_url(@recipe)}", {
        method: 'post', 
        body: body, 
        credentials: 'include', 
        headers: {
          'Content-Type': 'application/json',
          'X-Requested-With': 'XMLHttpRequest',
          'X-CSRF-Token': Rails.csrfToken()
      }}).then(function(response) {
        return response.json();
      }).then(function(data) {
        console.log(data);
      });
    })
  })
